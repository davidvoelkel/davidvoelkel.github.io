<!DOCTYPE html>
<html>
  <head>
    <title>Klavierschule Quiz Beispiel</title>
    <script>
      var maxNumberOfQuestions = 2;
      var questionsAudios = ['sekunde', 'terz', 'quarte', 'quinte'];
      
      var correctAnswers = ascendingIndices(questionsAudios.length)
      shuffleAnswers();      
      
      var currentQuestion = -1;

      function ascendingIndices(length) {
        var ascendingIndices = Array(length);
        for (i=0; i<length; i++) {
          ascendingIndices[i] = i;
        }
        return ascendingIndices
      }

      function shuffleAnswers () {
        for (i = correctAnswers.length - 1; i > 0; i--) {
          var randomSwapIndex = Math.floor(Math.random() * (i + 1));
          var temp = correctAnswers[i];
          correctAnswers[i] = correctAnswers[randomSwapIndex];
          correctAnswers[randomSwapIndex] = temp;
        }
      }

      function clickedAnswer(answer) {
        if (currentQuestion == -1) {
          startQuizClicked();
        } else {
          if (!isAnySoundAlreadyPlaying()) {
            if (correctAnswers[currentQuestion] === answer) {
              currentQuestion++;
              var finishedLastQuestion = currentQuestion === maxNumberOfQuestions
              if (finishedLastQuestion) {
                currentQuestion = -1;
                playSounds('alles-geschafft');
              } else {
                playSounds('antwort-richtig', audioIdFor(currentQuestion));
              }
            } else {
              playSounds('antwort-falsch', audioIdFor(currentQuestion)); 
            }
          }
        }
      } 

      function audioIdFor(questionIndex) {
        return questionsAudios[correctAnswers[questionIndex]];
      }

      function startQuizClicked() {
        if (!isAnySoundAlreadyPlaying()) { 
          shuffleAnswers();
          playSounds('quiz'); 
        }
      }

      function playSounds(audioId1, audioId2) {
        var firstSound = document.getElementById(audioId1)
        if (!!audioId2) {
          firstSound.setAttribute('onended', "javascript:document.getElementById('" + audioId2 + "').play()");
        }
        firstSound.play();
      } 

      function isAnySoundAlreadyPlaying() {
        var allAudioElements = document.getElementsByTagName('audio');
        for (var i=0; i<allAudioElements.length; i++) {
          // when there is already another (or the same) sound playing do not interrupt it
          if (!allAudioElements[i].paused) {
            return true;
          }
        }
        return false;
      }
    </script>
  </head>
  <body>
    <!-- Autoplay does not work in Chrome as intended by policy (https://stackoverflow.com/questions/50490304/how-to-make-audio-autoplay-on-chrome) -->
    <audio id="quiz" autoplay onended="javascript:playSounds(audioIdFor(0));currentQuestion = 0;">
      <source src="quiz.m4a" type="audio/mpeg"> Your browser does not support the audio element. 
    </audio>
    <audio id="sekunde"><source src="sekunde.m4a" type="audio/mpeg"></audio>
    <audio id="terz"><source src="terz.m4a" type="audio/mpeg"></audio>
    <audio id="quarte"><source src="quarte.m4a" type="audio/mpeg"></audio>
    <audio id="quinte"><source src="quinte.m4a" type="audio/mpeg"></audio>
    <audio id="antwort-richtig"><source src="antwort-richtig.m4a" type="audio/mpeg"></audio>
    <audio id="antwort-falsch"><source src="antwort-falsch.m4a" type="audio/mpeg"></audio>
    <audio id="alles-geschafft"><source src="alles-geschafft.m4a" type="audio/mpeg"></audio>

    <a href="#">
      <img src="../play.png" onclick="javascript:startQuizClicked()" style="vertical-align: top; width: 100px; display: block" />
    </a>
    <!-- SVG Generated by https://imagemapper.noc.io/ -->
    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 670 1072" style="max-width: 10cm">
      <image width="670" height="1072" xlink:href="esel.png"></image> 
      <a xlink:href="#quinte">
        <rect x="139" y="65" fill="#fff" opacity="0" width="151" height="147" onclick="javascript:clickedAnswer(3)"></rect>
      </a>
      <a xlink:href="#terz">
        <rect x="33" y="209" fill="#fff" opacity="0" width="153" height="151" onclick="javascript:clickedAnswer(1)"></rect>
      </a>
      <a xlink:href="#sekunde">
        <rect x="373" y="41" fill="#fff" opacity="0" width="145" height="141" onclick="javascript:clickedAnswer(0)"></rect>
      </a>
      <a xlink:href="#quarte">
        <rect x="485" y="272" fill="#fff" opacity="0" width="155" height="152" onclick="javascript:clickedAnswer(2)"></rect>
      </a>
    </svg>

  </body>
</html>