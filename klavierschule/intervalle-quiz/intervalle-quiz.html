<!DOCTYPE html>
<html>
  <head>
    <title>Klavierschule Quiz Beispiel</title>
    <script>
      var maxNumberOfQuestions = 2;
      var questionsAudios = ['sekunde', 'terz', 'quarte', 'quinte'];
      
      var correctAnswers = ascendingIndices(questionsAudios.length)
      shuffleArray(correctAnswers);      
      
      var currentQuestion = -1;

      function ascendingIndices(length) {
        var ascendingIndices = Array(length);
        for (i=0; i<length; i++) {
          ascendingIndices[i] = i;
        }
        return ascendingIndices
      }

      function shuffleArray (array) {
        for (i = array.length - 1; i > 0; i--) {
          var randomSwapIndex = Math.floor(Math.random() * (i + 1));
          var temp = array[i];
          array[i] = array[randomSwapIndex];
          array[randomSwapIndex] = temp;
        }
      }

      function clickedAnswer(answer) {
        if (currentQuestion >= 0 && !isAnySoundAlreadyPlaying()) {
          if (correctAnswers[currentQuestion] === answer) {
            currentQuestion++;
            var finishedLastQuestion = currentQuestion === maxNumberOfQuestions
            if (finishedLastQuestion) {
              playSounds('alles-geschafft');
            } else {
              playSounds('antwort-richtig', audioIdFor(currentQuestion));
            }
          } else {
            playSounds('antwort-falsch', audioIdFor(currentQuestion)); 
          }
        }
      } 

      function audioIdFor(questionIndex) {
        return questionsAudios[correctAnswers[questionIndex]];
      }

      function startQuiz() {
        if (!isAnySoundAlreadyPlaying()) { 
          playSounds('quiz'); 
        }
      }

      function playSounds(audioId1, audioId2) {
        var firstSound = document.getElementById(audioId1)
        if (!!audioId2) {
          firstSound.setAttribute('onended', "javascript:document.getElementById('" + audioId2 + "').play()");
        }
        firstSound.play();
      } 

      function isAnySoundAlreadyPlaying() {
        var allAudioElements = document.getElementsByTagName('audio');
        for (var i=0; i<allAudioElements.length; i++) {
          // when there is already another (or the same) sound playing do not interrupt it
          if (!allAudioElements[i].paused) {
            return true;
          }
        }
        return false;
      }
    </script>
  </head>
  <body>
    <!-- Autoplay does not work in Chrome as intended by policy (https://stackoverflow.com/questions/50490304/how-to-make-audio-autoplay-on-chrome) -->
    <audio id="quiz" autoplay onended="javascript:playSounds(audioIdFor(0));currentQuestion = 0;">
      <source src="quiz.m4a" type="audio/mpeg"> Your browser does not support the audio element. 
    </audio>
    <audio id="sekunde"><source src="sekunde.m4a" type="audio/mpeg"></audio>
    <audio id="terz"><source src="terz.m4a" type="audio/mpeg"></audio>
    <audio id="quarte"><source src="quarte.m4a" type="audio/mpeg"></audio>
    <audio id="quinte"><source src="quinte.m4a" type="audio/mpeg"></audio>
    <audio id="antwort-richtig"><source src="antwort-richtig.m4a" type="audio/mpeg"></audio>
    <audio id="antwort-falsch"><source src="antwort-falsch.m4a" type="audio/mpeg"></audio>
    <audio id="alles-geschafft"><source src="alles-geschafft.m4a" type="audio/mpeg"></audio>

    <a href="#">
      <img 
        src="https://cdn-icons-png.flaticon.com/512/98/98690.png?w=1480&t=st=1653945249~exp=1653945849~hmac=224024f6340c6ac346ab68cb7083199fe07bee44f5d6d985cf93054d6c29b1e9"
        onclick="javascript:startQuiz()"
      />
    </a>
    <img src="esel.png" usemap="#image-map">
    <!-- Image Map Generated by http://www.image-map.net/ -->
    <map name="image-map">
        <area alt="sekunde" title="sekunde" href="#" coords="446,111,66" shape="circle" onclick="javascript:clickedAnswer(0)">
        <area alt="terz"    title="terz"    href="#" coords="109,283,75" shape="circle" onclick="javascript:clickedAnswer(1)">
        <area alt="quarte"  title="quarte"  href="#" coords="567,346,71" shape="circle" onclick="javascript:clickedAnswer(2)">
        <area alt="quinte"  title="quinte"  href="#" coords="212,141,69" shape="circle" onclick="javascript:clickedAnswer(3)">
    </map>

  </body>
</html>